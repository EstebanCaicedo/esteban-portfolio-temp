<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Engineering Projects – Esteban Caicedo</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
 <header class="nav">
  <div class="nav-left">

    <a href="index.html" class="back-home">← Back to Home</a>

    <h1 class="site-title">
      Engineering Projects
    </h1>

    <p class="tagline">
      Portfolio of CAD/CAE work, interactive 3D models, and mixed-media engineering galleries.
    </p>

  </div>

  <nav class="nav-links">
    <a href="projects.html" class="active">Projects</a>
    <a href="https://www.linkedin.com/in/esteban-caicedo-945bb1300/" target="_blank" rel="noreferrer">
      LinkedIn
    </a>
  </nav>
</header>
  

    <main>
      <section aria-label="Projects grid">
        <div id="grid" class="grid"></div>
      </section>
    </main>
  </div>

  <script>
  // ---------- utils ----------
  const isVideo = (src)=>/\.(mp4|webm|ogg)$/i.test(src);

  function makeMediaEl(src) {
    if (isVideo(src)) {
      const v=document.createElement('video');
      v.src=src;
      v.muted=true;
      v.loop=true;
      v.autoplay=true;
      v.playsInline=true;
      v.preload='metadata';
      v.setAttribute('disablepictureinpicture','');

      // Controles al pasar el mouse
      v.addEventListener('mouseenter', ()=>{
        v.controls = true;
        v.muted = false;
      });
      v.addEventListener('mouseleave', ()=>{
        v.controls = false;
        v.muted = true;
      });

      return v;
    } else {
      const img=new Image();
      img.src=src;
      img.loading='lazy';
      img.alt='';
      return img;
    }
  }

  function mountMediaSlider(container, mediaPaths, heightPx, opts) {
    opts=opts||{};
    const autoplay = opts.autoplay!==false;
    const interval = opts.interval||3000;

    container.classList.add('slider');
    container.style.aspectRatio = '16 / 9';
    container.style.height = heightPx ? (heightPx+'px') : '';

    if (!mediaPaths || !mediaPaths.length) {
      container.classList.add('slider--empty');
      container.innerHTML = '<div class="slider-empty-msg">No media available</div>';
      return;
    }

    const a=document.createElement('div'); a.className='slide-layer active';
    const b=document.createElement('div'); b.className='slide-layer';
    let useA=true, idx=0, timer=null;

    a.appendChild(makeMediaEl(mediaPaths[0]||'')); 
    b.appendChild(makeMediaEl(mediaPaths[1]||mediaPaths[0]||''));
    container.append(a,b);

    const left=document.createElement('div'); left.className='ctrl left'; left.textContent='‹';
    const right=document.createElement('div'); right.className='ctrl right'; right.textContent='›';
    container.append(left,right);

    let dots=null;
    if (mediaPaths.length>1) {
      dots=document.createElement('div'); dots.className='dots';
      mediaPaths.forEach((_,i)=>{
        const d=document.createElement('span');
        d.className='dot'+(i===0?' active':'');
        d.onclick=()=>show(i);
        dots.appendChild(d);
      });
      container.appendChild(dots);
    }

    function show(nextIndex){
      idx=(nextIndex+mediaPaths.length)%mediaPaths.length;
      const target=(useA?b:a);
      target.innerHTML='';
      target.appendChild(makeMediaEl(mediaPaths[idx]||''));
      (useA?a:b).classList.remove('active');
      (useA?b:a).classList.add('active');
      useA=!useA;
      if(dots){
        dots.childNodes.forEach((d,i)=>d.className='dot'+(i===idx?' active':''));
      }
    }
    left.onclick=()=>show(idx-1);
    right.onclick=()=>show(idx+1);

    function start(){
      if(autoplay && mediaPaths.length>1) timer=setInterval(()=>show(idx+1), interval);
    }
    function stop(){
      if(timer){clearInterval(timer); timer=null;}
    }
    container.addEventListener('mouseenter',stop);
    container.addEventListener('mouseleave',start);
    start();
  }

  // ---------- render ----------
  async function renderCards() {
    const res = await fetch('projects.json', {cache:'no-store'});
    const projects = await res.json();
    const grid = document.getElementById('grid');
    grid.innerHTML='';

    projects.forEach((p, i)=>{
      const card=document.createElement('article');
      card.className='card card--fade-in';
      card.style.animationDelay = `${i * 60}ms`;

      // header
      const head=document.createElement('div');
      card.appendChild(head);
      const media=[...(p.images||[]), ...(p.videos||[])];
      mountMediaSlider(head, media, null, {autoplay:true});

      // body
      const body=document.createElement('div');
      body.className='card-body';
      body.innerHTML = `
        <h3 class="h3">${p.title}</h3>
        <p class="p-sm card-desc">${p.description || ''}</p>
        <div class="tags">
          ${(p.tags||[]).map(t=>`<span class="chip">${t}</span>`).join('')}
        </div>
        <a class="btn" href="project.html?slug=${encodeURIComponent(p.slug)}">Open</a>
      `;
      card.appendChild(body);

      grid.appendChild(card);
    });
  }

  document.addEventListener('DOMContentLoaded', renderCards);
  </script>
</body>
</html>
