<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project</title><link rel="stylesheet" href="style.css"/></head><body>
<a class="back" href="index.html">← Back</a><main id="root" class="proj"></main>
<script>
function qs(k){return new URL(location.href).searchParams.get(k)}function ext(u){const i=u.lastIndexOf('.');return i>=0?u.slice(i+1).toLowerCase():''}
async function main(){const slug=qs('slug');const data=await (await fetch('projects.json')).json();const p=data.find(x=>x.slug===slug)||data[0];
document.title='Project — '+p.title;const root=document.getElementById('root');const viewer=document.createElement('section');viewer.className='viewer';viewer.id='viewer';
const right=document.createElement('section');right.className='right';const hdr=document.createElement('div');hdr.style='padding:18px 20px 0;font-weight:700;font-size:22px';hdr.textContent=p.title;
const desc=document.createElement('div');desc.style='padding:6px 20px 14px;color:var(--mut)';desc.textContent=p.longDescription||p.description||'';
const slider=document.createElement('div');slider.className='slider';const mediaSrc=(p.images||[]).concat(p.videos||[]);let activeIdx=0;
function show(i){activeIdx=(i+mediaSrc.length)%mediaSrc.length;const src=mediaSrc[activeIdx];const type=ext(src);const el=(type==='mp4')?document.createElement('video'):document.createElement('img');
if(type==='mp4'){el.src=src;el.controls=true;el.playsInline=true;el.preload='metadata';}else{el.src=src;el.alt=p.title;}el.style.opacity=0;el.onload=el.onloadeddata=()=>{el.style.opacity=1;};
el.style.transition='opacity .35s';slider.replaceChildren(el);dots.querySelectorAll('.dot').forEach((d,idx)=>d.classList.toggle('active',idx===activeIdx));}
const dots=document.createElement('div');dots.className='track';mediaSrc.forEach((_,i)=>{const d=document.createElement('div');d.className='dot'+(i===0?' active':'');d.onclick=()=>show(i);dots.appendChild(d);});
if(mediaSrc.length===0){const ph=document.createElement('div');ph.style='height:100%;display:flex;align-items:center;justify-content:center;color:#789';ph.textContent='No media yet';slider.appendChild(ph);}else{show(0);}
right.append(hdr,desc,slider,dots);
if(p.model){const canvas=document.createElement('canvas');canvas.id='cv';viewer.appendChild(canvas);
const s=document.createElement('script');s.type='module';s.textContent=`
  import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160/build/three.module.js';
  import {OrbitControls} from 'https://cdn.jsdelivr.net/npm/three@0.160/examples/jsm/controls/OrbitControls.js';
  import {GLTFLoader} from 'https://cdn.jsdelivr.net/npm/three@0.160/examples/jsm/loaders/GLTFLoader.js';
  const renderer=new THREE.WebGLRenderer({canvas:document.getElementById('cv'),antialias:true});renderer.setPixelRatio(Math.min(devicePixelRatio,2));
  const scene=new THREE.Scene();scene.background=null;const camera=new THREE.PerspectiveCamera(45,1,0.1,100);camera.position.set(2,2,3);
  const light=new THREE.HemisphereLight(0xffffff,0x223355,1.1);scene.add(light);const key=new THREE.DirectionalLight(0xffffff,0.8);key.position.set(5,5,5);scene.add(key);
  const loader=new GLTFLoader();loader.load('${"${p.model}".replace("'","\'")}', g=>{scene.add(g.scene);fit();});
  const controls=new OrbitControls(camera,renderer.domElement);controls.enableDamping=true;
  function resize(){const box=document.getElementById('viewer').getBoundingClientRect();renderer.setSize(box.width,box.height);camera.aspect=box.width/box.height;camera.updateProjectionMatrix();}
  function fit(){const bb=new THREE.Box3().setFromObject(scene);const s=bb.getSize(new THREE.Vector3()).length();const c=bb.getCenter(new THREE.Vector3());
    controls.target.copy(c);camera.near=s/100;camera.far=s*100;camera.updateProjectionMatrix();camera.position.copy(c).add(new THREE.Vector3(1.6,1.2,1.6).multiplyScalar(s*0.6));controls.update();resize();}
  window.addEventListener('resize',resize,{passive:true});resize();renderer.setAnimationLoop(()=>{controls.update();renderer.render(scene,camera);});
`;document.body.appendChild(s);}else{const ph=document.createElement('div');ph.style='color:#789';ph.textContent='No 3D model attached.';viewer.appendChild(ph);}
root.append(viewer,right);}main();
</script></body></html>